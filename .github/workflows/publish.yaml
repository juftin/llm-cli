name: Publishing

on:
    release:
        types:
            - published
    workflow_dispatch:

jobs:
    pypi-publish:
        name: PyPI
        if: github.repository_owner == 'juftin' && (github.event_name == 'release' || (github.event_name == 'workflow_dispatch' && github.actor == 'juftin'))
        runs-on: ubuntu-latest
        environment:
            name: pypi
            url: https://pypi.org/p/llm-term
        permissions:
            id-token: write
        steps:
            - name: Check out the repository
              uses: actions/checkout@v4
              with:
                  fetch-depth: 2
            - name: Install uv
              uses: astral-sh/setup-uv@v5
              with:
                  version: latest
                  python-version: 3.11
            - name: Install Task
              uses: arduino/setup-task@v2
            - name: Build package
              run: uv build
            - name: Publish package on PyPI
              uses: pypa/gh-action-pypi-publish@release/v1
